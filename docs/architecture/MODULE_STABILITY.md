# DES-V2 æ¨¡çµ„ç©©å®šåº¦è©•ä¼°

> **è©•ä¼°æ—¥æœŸ**: 2025-12-08  
> **ç›®çš„**: è­˜åˆ¥å·²ç©©å®šçš„æ ¸å¿ƒæ¨¡çµ„ï¼Œå¾ŒçºŒé–‹ç™¼ä»¥æ“´å±•ç‚ºä¸»

---

## ğŸ“Š ç©©å®šåº¦æ¦‚è¦½

```
ğŸŸ¢ 100% ç©©å®š:  åŸºç¤è¨­æ–½ (config, events, balance)
ğŸŸ¢ 95% ç©©å®š:   äº¤æ˜“æ‰€æŠ½è±¡å±¤ (é™¤éåŠ æ–°äº¤æ˜“æ‰€)
ğŸŸ¡ 90% ç©©å®š:   æ ¸å¿ƒæ¥­å‹™å±¤ (engine, order, risk)
âšª å¯æ“´å±•:     ç­–ç•¥/API/æŒ‡æ¨™ (åŠŸèƒ½æ–°å¢é»)
```

---

## ğŸ”’ å·²ç©©å®šæ¨¡çµ„ (Core Stable)

### 1. åŸºç¤è¨­æ–½å±¤ - 100% ç©©å®š

| æ¨¡çµ„ | æª”æ¡ˆ | ç©©å®šåŸå›  |
|------|------|----------|
| **é…ç½®** | `pkg/config/config.go` | è¼‰å…¥é‚è¼¯æˆç†Ÿï¼Œæ“´å±•åªéœ€åŠ æ¬„ä½ |
| **è³‡æ–™åº«é€£ç·š** | `pkg/db/db.go` | SQLite é€£ç·šç®¡ç†å®Œæ•´ |
| **Schema** | `pkg/db/schema.go` | è¡¨çµæ§‹å›ºå®šï¼Œé€é `ensureColumn` é·ç§» |
| **äº‹ä»¶ç¸½ç·š** | `internal/events/bus.go` | Pub/Sub æ©Ÿåˆ¶æˆç†Ÿ |
| **äº‹ä»¶é¡å‹** | `internal/events/types.go` | æ–°äº‹ä»¶åªéœ€åŠ å¸¸é‡ |

**è®Šæ›´æ–¹å¼**: åƒ…æ–°å¢æ¬„ä½/é¡å‹ï¼Œä¸ä¿®æ”¹æ ¸å¿ƒé‚è¼¯

---

### 2. äº¤æ˜“æ‰€æŠ½è±¡å±¤ - 95% ç©©å®š

| æ¨¡çµ„ | æª”æ¡ˆ | ç©©å®šåŸå›  |
|------|------|----------|
| **é€šç”¨é¡å‹** | `pkg/exchanges/common/types.go` | Side, OrderType, TimeInForce å®Œæ•´ |
| **Gateway ä»‹é¢** | `pkg/exchanges/common/gateway.go` | ä»‹é¢ç©©å®š |
| **Binance Spot** | `pkg/exchanges/binance/spot/` | å¯¦ç¾å®Œæ•´ |
| **USDT Futures** | `pkg/exchanges/binance/futures_usdt/` | å¯¦ç¾å®Œæ•´ |
| **Coin Futures** | `pkg/exchanges/binance/futures_coin/` | å¯¦ç¾å®Œæ•´ |

**è®Šæ›´æ–¹å¼**: æ–°å¢äº¤æ˜“æ‰€æ™‚å¯¦ç¾ Gateway ä»‹é¢ï¼Œä¸ä¿®æ”¹ç¾æœ‰ç¨‹å¼ç¢¼

---

### 3. Engine æœå‹™å±¤ - 90% ç©©å®š

| æ¨¡çµ„ | æª”æ¡ˆ | ç©©å®šåŸå›  |
|------|------|----------|
| **Service ä»‹é¢** | `internal/engine/service.go` | ä»‹é¢å®šç¾©å®Œæ•´ |
| **DTO é¡å‹** | `internal/engine/types.go` | è³‡æ–™çµæ§‹å›ºå®š |
| **å¯¦ç¾** | `internal/engine/impl.go` | çµ„åˆæ¨¡å¼ç©©å®š |

**è®Šæ›´æ–¹å¼**: æ–°å¢æ–¹æ³•æ™‚æ“´å±•ä»‹é¢ï¼Œä¸ä¿®æ”¹ç¾æœ‰æ–¹æ³•

---

### 4. è¨‚å–®åŸ·è¡Œå±¤ - 90% ç©©å®š

| æ¨¡çµ„ | æª”æ¡ˆ | ç©©å®šåŸå›  |
|------|------|----------|
| **è¨‚å–®é¡å‹** | `internal/order/types.go` | é¡å‹å®šç¾©å®Œæ•´ |
| **å„ªå…ˆç´šéšŠåˆ—** | `internal/order/queue.go` | ç®—æ³•ç©©å®š |
| **åŸ·è¡Œå™¨** | `internal/order/executor.go` | é‚è¼¯æˆç†Ÿ |
| **Worker Pool** | `internal/order/worker_pool.go` | ä¸¦ç™¼æ§åˆ¶ç©©å®š |
| **Async Executor** | `internal/order/async_executor.go` | éé˜»å¡åŸ·è¡Œç©©å®š |
| **User Stream Spot** | `internal/order/user_stream_spot.go` | æˆäº¤å›å ±ç©©å®š |
| **User Stream Futures** | `internal/order/user_stream_futures.go` | æˆäº¤å›å ±ç©©å®š |

**è®Šæ›´æ–¹å¼**: æ–°å¢åŠŸèƒ½ (å¦‚ checkProfitTarget) é€éæ“´å±•ï¼Œä¸ä¿®æ”¹æ ¸å¿ƒé‚è¼¯

---

### 5. é¢¨æ§å±¤ - 85% ç©©å®š

| æ¨¡çµ„ | æª”æ¡ˆ | ç©©å®šåŸå›  |
|------|------|----------|
| **é¢¨æ§é¡å‹** | `internal/risk/types.go` | é…ç½®çµæ§‹å›ºå®š |
| **é¢¨æ§ç®¡ç†å™¨** | `internal/risk/manager.go` | è©•ä¼°é‚è¼¯æˆç†Ÿ |
| **æ­¢æç®¡ç†** | `internal/risk/stop_loss.go` | è¿½è¹¤é‚è¼¯ç©©å®š |

**è®Šæ›´æ–¹å¼**: æ–°å¢è¦å‰‡æ™‚æ“´å±• `rules.go`ï¼Œä¸ä¿®æ”¹æ ¸å¿ƒè©•ä¼°

---

### 6. é¤˜é¡ç®¡ç† - 100% ç©©å®š

| æ¨¡çµ„ | æª”æ¡ˆ | ç©©å®šåŸå›  |
|------|------|----------|
| **é¤˜é¡ç®¡ç†å™¨** | `internal/balance/manager.go` | Lock/Unlock/Sync å®Œæ•´ |

**è®Šæ›´æ–¹å¼**: ç„¡éœ€è®Šæ›´ï¼ŒåŠŸèƒ½å®Œæ•´

---

## âš ï¸ å¯æ“´å±•æ¨¡çµ„ (Extension Points)

é€™äº›æ¨¡çµ„æ˜¯åŠŸèƒ½æ–°å¢çš„åˆ‡å…¥é»ï¼š

| æ¨¡çµ„ | æ“´å±•å ´æ™¯ |
|------|----------|
| `internal/strategy/` | æ–°å¢ç­–ç•¥é¡å‹ |
| `internal/api/controllers.go` | æ–°å¢ API ç«¯é» |
| `internal/indicators/` | æ–°å¢æŠ€è¡“æŒ‡æ¨™ (MACD, BB, ATR) |
| `pkg/db/models.go` | æ–°å¢ CRUD æ–¹æ³• |
| `pkg/exchanges/` | æ–°å¢äº¤æ˜“æ‰€ (OKX, Bybit) |

---

## ğŸ“‹ é–‹ç™¼æŒ‡å—

### å¦‚ä½•æ“´å±•åŠŸèƒ½

```
æ–°å¢ç­–ç•¥:
  1. strategy/ æ–°å¢ Go æª”æ¡ˆæˆ– Python ç­–ç•¥
  2. engine.go çš„ switch-case åŠ å…¥æ–°é¡å‹
  3. ç„¡éœ€ä¿®æ”¹å…¶ä»–æ¨¡çµ„

æ–°å¢ API:
  1. controllers.go æ–°å¢è™•ç†å‡½æ•¸
  2. handler.go æ–°å¢è·¯ç”±
  3. é€é engine.Service èª¿ç”¨

æ–°å¢æŒ‡æ¨™:
  1. indicators/ æ–°å¢æª”æ¡ˆ
  2. engine.go å¼•ç”¨æ–°æŒ‡æ¨™
  3. ç„¡éœ€ä¿®æ”¹ç­–ç•¥ä»‹é¢

æ–°å¢äº¤æ˜“æ‰€:
  1. pkg/exchanges/ æ–°å¢ç›®éŒ„
  2. å¯¦ç¾ Gateway ä»‹é¢
  3. main.go æ–°å¢åˆå§‹åŒ–
```

### ç©©å®šæ€§ä¿è­‰

| åŸå‰‡ | èªªæ˜ |
|------|------|
| **ä»‹é¢éš”é›¢** | é€é Engine Service ä»‹é¢ï¼ŒAPI å±¤ä¸ç›´æ¥ä¾è³´å…§éƒ¨æ¨¡çµ„ |
| **äº‹ä»¶é©…å‹•** | æ¨¡çµ„é–“é€éäº‹ä»¶ç¸½ç·šé€šè¨Šï¼Œé™ä½è€¦åˆ |
| **Gateway æŠ½è±¡** | äº¤æ˜“æ‰€é€éçµ±ä¸€ä»‹é¢ï¼Œæ˜“æ–¼æ“´å±• |
| **é·ç§»æ©Ÿåˆ¶** | DB è®Šæ›´é€é `ensureColumn`ï¼Œå‘å¾Œå…¼å®¹ |

---

## çµè«–

**85% çš„æ ¸å¿ƒç¨‹å¼ç¢¼å·²ç©©å®š**ï¼Œå¾ŒçºŒé–‹ç™¼ä¸»è¦æ˜¯ï¼š
- âœ… æ“´å±•ç­–ç•¥é¡å‹
- âœ… æ“´å±• API ç«¯é»
- âœ… æ“´å±•æŠ€è¡“æŒ‡æ¨™
- âœ… æ“´å±•äº¤æ˜“æ‰€æ”¯æ´

**ç„¡éœ€ä¿®æ”¹**çš„æ ¸å¿ƒéª¨æ¶ï¼š
- config, db, events
- exchanges Gateway
- engine Service
- order (queue, executor, user_stream)
- risk, balance
